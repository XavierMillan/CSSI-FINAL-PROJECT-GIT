<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Lesson 3</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

  <link rel="stylesheet"
    href="A.fonts,,_icomoon,,_style.css+css,,_owl.carousel.min.css+css,,_bootstrap.min.css+css,,_style.css,Mcc.iq-Irt1J63.css.pagespeed.cf.67EAq9-gxU.css">

  <script src="editor/acorn.js"></script>
  <script src="editor/interpreter.js"></script>
  <script src="editor/babel.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/languages/php.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/styles/purebasic.min.css" />
  <script
    src="//cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/highlightjs-line-numbers.js@2.8.0/dist/highlightjs-line-numbers.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
    hljs.initLineNumbersOnLoad();
  </script>
  <style>
    html,
    body {
      height: 150%;
      width: 100%;
      overflow: scroll;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      margin: 0 auto;
      width: auto;
      text-align: center;
    }

    p {
      margin-left: 30%;
      margin-right: 30%;
      text-align: center;
      color: black;
    }

    .hljs {
      background: lightgrey;

      margin-left: 30%;

      height: 100%;
    }

    .results {
      background: black;
      margin-right: 30%;
      color: white;
      padding: 6.5px;
    }

    .parent {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: 1fr;
      grid-column-gap: 0px;
      grid-row-gap: 0px;
    }

    .preMargin {
      margin-bottom: 0;
    }

    .center {
      margin: auto;
      width: 50%;
      border: 3px solid green;
      padding: 10px;
    }
  </style>

</head>

<header class="site-navbar" role="banner">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-11 col-xl-2">
        <h1 class="mb-0 site-logo"><a href="index.html" class="text-black mb-0" style="color: black">SOC</a></h1>
      </div>
      <div class="col-12 col-md-10 d-none d-xl-block">
        <nav class="site-navigation position-relative text-right" role="navigation">
          <ul class="site-menu js-clone-nav mr-auto d-none d-lg-block">
            <li><a href="index.html"><span style="color: black">Home</span></a></li>
            <li class="active"><a id='studentNav' style="display: hidden;" href="progression.html"><span
                  style="color: black">For
                  Students</span></a></li>
            <li><a id='teachersNav' style="display: hidden;" href="teachers.html"><span style="color: black">For
                  Teachers</span></a></li>

            <li><a href="about.html"><span style="color: black">About Us</span></a></li>
            <li><a href="forum.html"><span style="color: black">Forum</span></a></li>
            <li><a href="login.html" id="account"><span style="color: black">Login</span></a></li>
          </ul>
        </nav>
      </div>
      <div class="d-inline-block d-xl-none ml-md-0 mr-auto py-3" style="position: relative; top: 3px;"><a href="#"
          class="site-menu-toggle js-menu-toggle text-white active"><span class="icon-menu h3"></span></a></div>
    </div>
  </div>

</header>

<body style="overflow: visible; display: none">
  <br>
  <br>
  <br>
  <br>
  <br>
  <h1 style="margin: 0 auto; width: auto; text-align: center;">Lesson 3: loops</h1>
  <br>
  <div style="margin: 0 auto; width: 656px; text-align: center;">
    <a id="helplink" href="https://cssi-main.xavim1.repl.co/forum.html?postid=1659583747660.I4PKXme0uqXYmvEymdTMj1sARy33"><button
        class="btn btn-primary" id="help" style="width: 20%">Need Help</button></a>
  </div>
  <br>
  <h4>Loops are used to execute code multiple times</h4>
  <br>
  <p>There are two main types of loops 'for' and 'while' loops. 'for' loops have the variable you are using to track the
    number of repetitions in the head of the loop on the other hand 'while' loops head is more akin to that of an if
    statement where there is a single boolean expression where the loop will continue to run while that condition is
    true.</p>
  <br>
  <div class="parent">
    <pre
      class='preMargin'><code id="editor1" class="Javascript editor" contentEditable="true">/*For Loop*/ <br>for(let i = 0; i < 4; i++){ <br>    console.log(i);<br>} <br>/*While Loop*/ <br>let j = 0; <br>while(j<4){ <br>    console.log(j*10); <br>    j++; </br>}<br></code></pre>

    <div class="results" id="result1"></div>

  </div>
  <div style="margin: 0 auto; width: 656px; text-align: center;">
    <br>
    <button class="btn btn-success" id="run1" style="width: 15%">Run</button>
    <!--   <button id="clear1" class="btn btn-warning" style="width: 15%">Clear</button> -->
  </div>

  <br>
  <h4>All strings have an index systsem corresponding to the position of every character</h4>
  <br>
  <p>
    The numbering of indices starts at zero for the beggining character for an example run the code below!
  </p>
  <br>
  <div class="parent">
    <pre
      class='preMargin'><code id="editor2" class="Javascript editor" contentEditable="true">let myString = "Hi, Bob!"; <br><br>for(let i =0; i < myString.length; i++){ <br>    console.log(myString.charAt(i)); <br>} <br><br><br><br></code></pre>

    <div class="results" id="result2"></div>

  </div>
  <div style="margin: 0 auto; width: 656px; text-align: center;">
    <br>
    <button class="btn btn-success" id="run2" style="width: 15%">Run</button>
    <!--   <button id="clear2" class="btn btn-warning" style="width: 15%">Clear</button> -->
  </div>

  <br>
  <h4>You can also us loop to perform mathematical operations</h4>
  <br>
  <p>
    Since multiplication is just repeated addition we can use a loop for that!
  </p>
  <br>

  <div class="parent">
    <pre
      class='preMargin'><code id="editor3" class="Javascript editor" contentEditable="true">/*Change x to make 30 print to the screen*/<br>/*Remember the loop starts at 0 not 1!*/<br>let myNum = 5; <br>let x= null;<br>for(let i = 0; i < x; i++){ <br>    myNum= myNum +5; <br>} <br>console.log(myNum); <br><br></code></pre>

    <div class="results" id="result3"></div>

  </div>
  <div style="margin: 0 auto; width: 656px; text-align: center;">
    <br>
    <button class="btn btn-success" id="run3" style="width: 15%">Run</button>
    <!--     <button id="clear3" class="btn btn-warning" style="width: 15%">Clear</button> -->
  </div>

  <br>
  <h4>Activity: Counting letters</h4>
  <p>Sally is a teacher who wants to say hello to all of her students at the beginning of class. She made the program
    below to log a greeting to the console for every student in ehr class. Run the code below and then try the
    activties!</p>
  <br>
  <p style='height:130px; overflow-y:scroll; background-color:rgb(217, 233, 255)'>
    1. After running the code, you will notice five greetings are displayed in the console. The greeting variable
    ('hello') followed by the value of i. In for loop, the value of i starts at one ( let i = 1; ). Then, the
    conditional statement asserts that while it is true that i is less than or equal to the number of students in
    Sally's class, the content of the for loop will run ( i <= numberOfStudents; ). Finally, after each run of the for
      loop's content, the value of i will increase by 1 ( i +=1).<br>Try changing the 1 in (i += 1) to 2! Run the code
      again, what happens?<br><br>2. Go a head and change the 2 back to a 1 from the previous step. Now, try changing
      Sally's number of students to 30! (hint: the number of students is stored in the numberOfStudents
      variable)<br><br>3. Sally no longer wants to say 'hello!' Can you edit the greeting variable to a new phrase of
      your choosing? Try running the program. <br><br>4. CHALLENGE: Sally wants to log a different phrase to the console
      for every other student. Can you use another conditional statement within the for loop to log a different phrase
      to the console for every other student? (ex. say 'hello' on odd numbers and 'hi' on even numbers). </p>
  <div class="parent">
    <pre
      class='preMargin'><code id="editor4" class="Javascript editor" contentEditable="true">let numberOfStudents = 5;<br>let greeting = 'hello!';<br><br>for (let i = 1; i <= numberOfStudents; i += 1) {<br>  console.log('greeting' + i)<br>}<br><br><br><br></code></pre>

    <div class="results" id="result4"></div>

  </div>
  <div style="margin: 0 auto; width: 656px; text-align: center; padding-bottom:2rem;">
    <br>
    <button class="btn btn-success" id="run4" style="width: 15%">Run</button>
    <!--     <button id="clear4" class="btn btn-warning" style="width: 15%">Clear</button> -->
  </div>

  <!--   Im going to do another activity practicing a while loop here -->

  <br>
  <h4>Knowledge Test</h4>
  <p>create a for statement so that the phrase 'for' logs to the console 5 times. Then, make a while loop so that the
    phrase 'while' logs to the console 3 times! Remember to use brackets, and refer to the previous exercises for a
    refresher on the format of loops.</p>

  <div class="parent">
    <pre
      class='preMargin'><code id="editor5" class="Javascript editor" contentEditable="true"><br><br><br><br><br><br><br><br></code></pre>
    <!--     for ( i = 0; i < 5; i++) {<br>console.log('for')<br>}<br>let i = 0;<br>while (i < 3) {<br>  console.log('while');<br>i++;<br>}<br><br><br><br> -->

    <div class="results" id="result5"></div>

  </div>
  <div style="margin: 0 auto; width: 656px; text-align: center; padding-bottom:2rem;">
    <br>
    <button class="btn btn-success" id="run5" style="width: 15%">Run</button>
    <!--     <button id="clear5" class="btn btn-warning" style="width: 15%">Clear</button> -->
    <button class="btn btn-success" id="grade" style="width: 15%">Grade</button>
  </div>

</body>


<footer style="padding-top:1rem; padding-bottom:1.5rem; background:lightgrey;">
  <div class="container" style="text-align: center;">
    <a class="text-primary" href="index.html">
      <h5>Home üè†</h5>
    </a>
    <a class="text-primary" href="">
      <h6>Back to top üîù</h6>
    </a>
  </div>
</footer>

<scrip src="https: //cdnjs.cloudflare.com/ajax/libs/firebase/9.9.1/firebase-app.js">
  </script>
  <script src="https://www.gstatic.com/firebasejs/5.0.4/firebase.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>


  <script>

    // function resizeEditor() {
    //   var divs = document.getElementsByClassName("results");
    //   for (var i = 0; i < divs.length; i++) {
    //     console.log(divs[i].style.height);
    //     console.log(divs[i].clientHeight);
    //     console.log((divs[i].clientHeight - 14) + "px");
    //     divs[i].style.height = (divs[i].clientHeight - 2) + "px";
    //   }
    // }
    // resizeEditor();


    let errorBool = false;
    function getCode(num) {
      console.log(num);
      let result = "result" + num;
      let editor = "editor" + num;
      console.log(editor, result);
      //clear result
      document.getElementById(result).innerHTML = "";
      // console.oldLog = console.log.bind(console);
      // console.log = function(value)
      // {
      //     document.getElementById("result").innerHTML += value + "<br>";
      //     console.oldLog(value);
      //     return value;
      // };

      //prevent eval if gl
      // var code = document.getElementById("editor").innerHTML.replace(/<span.*?>/g, "").replace(/<\/span>/g, "") + document.getElementById("editor").innerHTML.replace(/<span.*?>/g, "").replace(/<\/span>/g, "");
      //replace all the div tags in code with nothing

      //TODO: maybe add back
      var code = document.getElementById(editor).innerHTML;
      console.log(code);
      //remove html tags before parsing and executing
      code = code.replace(/<span.*?>/g, "").replace(/<\/span>/g, "");
      code = code.replace(/<div.*?>/g, "").replace(/<\/div>/g, "");
      code = code.replace(/<pre.*?>/g, "").replace(/<\/pre>/g, "");
      code = code.replace(/<code.*?>/g, "").replace(/<\/code>/g, "");
      code = code.replace(/font.*?>/g, "").replace(/<\/font>/g, "");
      code = code.replace(/<br>/g, "");


      //errors wehn using boolean statements
      //replace all html tags with nothing
      // code = code.replace(/<.*?>/g, "");

      //line formatting
      //comvert &gt; to > and &lt; to < and &amp; to & and &quot; to " and &apos; to "' and &nbsp; to " " and &#xA; to "\n" and &#xD; to "\r" and &#x9; to "\t"
      code = code.replace(/&gt;/g, ">").replace(/&lt;/g, "<").replace(/&amp;/g, "&").replace(/&quot;/g, "\"").replace(/&apos;/g, "'").replace(/&nbsp;/g, " ").replace(/&#xA;/g, "\n").replace(/&#xD;/g, "\r").replace(/&#x9;/g, "\t");
      //add new line after every } or{
      code = code.replace(/{/g, "{\n");
      code = code.replace(/}/g, "}\n");
      //add a new line after every ;
      code = code.replace(/;/g, ";\n");

      code = Babel.transform(code, {'presets': ['es2015']}).code;

      console.log('converted code: \n ', code);
      // console.log(code.substr(15))
      // alert(code);



      var initFunc = function (interpreter, globalObject) {
        // Create 'console' global object.
        var pseudoConsole = interpreter.nativeToPseudo({});
        interpreter.setProperty(globalObject, 'console', pseudoConsole);

        // Define 'console.log' function.
        var wrapper = function log(value) {
          document.getElementById(result).innerHTML += value + "<br>";
          return console.log('value', value);
        };
        interpreter.setProperty(pseudoConsole, 'log',
          interpreter.createNativeFunction(wrapper));
      };
      try {
        var myInterpreter = new Interpreter(code, initFunc);
        errorBool = false;
        myInterpreter.run();
      }
      catch (e) {
        errorBool = true;
        document.getElementById(result).innerHTML = e.toString();
        console.log('result', e);
      }

    }



    document.getElementById("run1").addEventListener("click", function () {
      console.log('click1');
      getCode(1);
    });

    // document.getElementById("clear1").addEventListener("click", function() {
    //     document.getElementById("result1").innerHTML = "";
    //   document.getElementById("editor1").innerHTML = "";
    //   resizeEditor();
    // });

    document.getElementById("run2").addEventListener("click", function () {
      console.log('click2');
      getCode(2);
    });

    document.getElementById("run3").addEventListener("click", function () {
      console.log('click3');
      getCode(3);
    });

    document.getElementById("run4").addEventListener("click", function () {
      console.log('click4');
      getCode(4);
    });

    document.getElementById("run5").addEventListener("click", function () {
      console.log('click5');
      getCode(5);
    });


    document.getElementById("grade").addEventListener("click", function () {
      console.log('click5');
      getCode(5);
      setTimeout(() => {
        console.log(errorBool);
        console.log(grade());
        if (!errorBool && grade()) {
          increaseLevel()
          alert("level completed");
        }
      }, 1000);

    });


    /* sample solution:
for ( i = 0; i < 5; i++) {
console.log('for')
}
let i = 0;
while (i < 3) {
  console.log('while');
i++;
}


    */
    function grade() {
      var code = document.getElementById('editor5').innerHTML;
      code = code.toLowerCase();
      let countConsoleWhile = (code.match(/while/g) || []).length;
      let countConsoleFor = (code.match(/for/g) || []).length;

      var consolex = document.getElementById('result5').innerHTML;
      consolex = consolex.toLowerCase();
      let countResultWhile = (consolex.match(/while/g) || []).length;
      let countResultFor = (consolex.match(/for/g) || []).length;
      // let countConsole = (code.match(/console.log/g) || []).length;
      if (countConsoleWhile >= 2 && countConsoleFor >= 2 && countResultWhile == 3 && countResultFor == 5) {
        return true;
      }
      else {
        return false;
      }
    }

    // document.getElementById("clear2").addEventListener("click", function() {
    //     document.getElementById("result2").innerHTML = "";
    //   document.getElementById("editor2").innerHTML = "";
    //   resizeEditor();
    // });
    const firebaseConfig = {
      apiKey: "AIzaSyDeaWpE9wc6VvPEilrEAqhEnjKo8ik1Stw",
      authDomain: "cssifinal-884f2.firebaseapp.com",
      projectId: "cssifinal-884f2",
      storageBucket: "cssifinal-884f2.appspot.com",
      messagingSenderId: "331915175322",
      appId: "1:331915175322:web:ab968dfdccc693e2094623",
      measurementId: "G-LB249TWWMB"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    function increaseLevel() {
      firebase.auth().onAuthStateChanged((user) => {
        if (user) {
          console.log("logged in");
          async function updateLevel() {

            let user = firebase.auth().currentUser;
            let userID = user.uid;
            let docRef = db.collection("user-data").doc(userID);
            let doc = await docRef.get();
            var data = "";
            if (doc.exists) {
              data = doc.data().level;
              console.log(data);
            }
            if (data == 5) {
              let newLevel = docRef.update({level: data + 1});
              console.log(newLevel);
            }


          }

          updateLevel();

        }
        else {
          console.log("logged out");
        }
      });
    }
    //call this lien to increase level by
    // increaseLevel();

    firebase.auth().onAuthStateChanged((user) => {
      if (user) {
        console.log("logged in");
        var data = "";
        async function getLevel() {

          let user = firebase.auth().currentUser;
          let userID = user.uid;
          let docRef = db.collection("user-data").doc(userID);
          let doc = await docRef.get();

          if (doc.exists) {
            data = doc.data().level;
            console.log(data);

            if (data < 5) {
              console.log("no access");
              window.location.href = "progression.html";
            }
            document.body.style.display = "block";

          }
          // resizeEditor();
          // resizeEditor();
        }
        getLevel();

        async function getData() {
          var user = firebase.auth().currentUser;
          var userID = user.uid;
          var docRef = db.collection("user-data").doc(userID);
          var doc = await docRef.get();
          if (doc.exists) {
            role = doc.data().role;
            console.log(role);

            // document.getElementById("studentNav").style.display = "none";
            // document.getElementById("teachersNav").style.display = "none";

            console.log(role);

            if (role == "Demo") {
              console.log('Demo');
              document.getElementById("studentNav").style.display = "block";
              document.getElementById("teachersNav").style.display = "block";
              document.getElementById('link').href = 'progression.html';
              document.getElementById('link').innerHTML = "Student Page";
            }
            else if (role == "Teacher") {
              console.log('teacher');
              document.getElementById("studentNav").style.display = "block";
              document.getElementById("teachersNav").style.display = "block";
              document.getElementById('link').href = 'teachers.html';
              document.getElementById('link').innerHTML = "Teacher Page";
            }
            else {
              console.log('student');
              document.getElementById("studentNav").style.display = "block";
              document.getElementById("teachersNav").style.display = "none";
              document.getElementById('link').href = 'progression.html';
              document.getElementById('link').innerHTML = "Student Page";
            }
          }
        }
        getData();
        console.log(document.body.style.display);
        document.body.style.display = "block";
        console.log(document.body.style.display);
        document.getElementById("account").href = "loggedin.html";
        document.getElementById("account").innerHTML = '<span style="color: black">My Account</span>';

      }
      else {
        window.location.href = "index.html";
        console.log("logged out");
      }
    });


  </script>

  <script>
//https://cssi-main.xavim1.repl.co/forum.html?postid=1659583747660.I4PKXme0uqXYmvEymdTMj1sARy33
    
     var getUrl = window.location;
          var baseUrl = getUrl.protocol + "//" + getUrl.host + "/" + 'forum.html';
          console.log(baseUrl);
          let shareUrl = `${baseUrl}?postid=1659583747660.I4PKXme0uqXYmvEymdTMj1sARy33`;
          console.log(shareUrl);
    document.getElementById('helplink').href = shareUrl;
</script>

  
</html>